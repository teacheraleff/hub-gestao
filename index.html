<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub SLAP</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749543469/SLAP_FAVICON_AMARELO_coilvj.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Palette: SLAP Brand Colors: #F1D24B (Yellow), #FF5C3D (Orange), #84C7DF (Blue), #8671D1 (Purple) -->
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
            line-height: 1.25;
        }
        .nav-item.active {
            background-color: #FFFBEB; /* yellow-50 */
            color: #F1D24B;
            font-weight: 600;
        }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.75rem; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e7e5e4; padding-bottom: 1rem; margin-bottom: 1rem; }
        .modal-header h4 { font-size: 1.25rem; font-weight: 700; color: #44403c; }
        .modal-close-btn { background: none; border: none; cursor: pointer; color: #a8a29e; }
        
        .base-card { background-color: #ffffff; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #e7e5e4; transition: all 0.2s; }
        .base-card:hover { border-color: #F1D24B; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .status-tag { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .status-aprovado, .status-presencial, .status-ativo { background-color: #D1FAE5; color: #065F46; }
        .status-online, .status-em-andamento, .status-inativo { background-color: #DBEAFE; color: #1E40AF; }
        .status-concluída { background-color: #F3F4F6; color: #4B5563; }
        .status-pendente, .status-em-espera { background-color: #FEF3C7; color: #92400E; }
        .status-rejeitado, .status-cancelado { background-color: #FEE2E2; color: #991B1B; }

        .status-financeiro { background-color: #D1FAE5; color: #065F46; }
        .status-pedagógico { background-color: #DBEAFE; color: #1E40AF; }
        .status-comercial { background-color: #FEF3C7; color: #92400E; }
        .status-marketing { background-color: #FEE2E2; color: #991B1B; }
        
        .sector-tag, .keyword-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1.5px solid #F1D24B;
            color: #44403c;
            background-color: transparent;
        }

        /* Modality Tags */
        .modality-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
            margin-left: 0.5rem;
        }
        .modality-turma {
            background-color: #FF5C3D;
        }
        .modality-vip {
            background-color: #8671D1;
        }

        .task-card { background-color: #ffffff; border-radius: 0.75rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #e7e5e4; transition: all 0.2s ease; }
        .task-card.completed { background-color: #f9fafb; border-color: #e5e7eb; }
        .task-card.completed p { text-decoration: line-through; color: #9ca3af; }
        .task-card:hover { border-color: #F1D24B; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .user-tag { display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .tag-admin { background-color: #E5E7EB; color: #374151; }
        .tag-break { background-color: #374151; color: #FFFFFF; }
        .deadline-text { font-weight: 600; color: #57534e; }
        .deadline-overdue { color: #b91c1c; }
        .task-delete-btn { background: none; border: none; cursor: pointer; color: #9ca3af; transition: color 0.2s; }
        .task-delete-btn:hover { color: #ef4444; }
        
        .page-number-btn { padding: 0.25rem 0.75rem; border: 1px solid #d6d3d1; background-color: #ffffff; color: #44403c; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; }
        .page-number-btn:hover { background-color: #f5f5f4; border-color: #F1D24B; }
        .page-number-btn.active { background-color: #F1D24B; border-color: #F1D24B; color: #44403c; font-weight: 600; }

        .grade-select-container { margin-bottom: 1.5rem; max-width: 400px; }
        .grade-select { width: 100%; padding: 0.75rem 1rem; border-radius: 0.5rem; border: 1px solid #d6d3d1; background-color: #ffffff; font-weight: 600; color: #44403c; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; }
        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
        .day-column { background-color: #f9fafb; border-radius: 0.75rem; padding: 1rem; border: 1px solid #f3f4f6; }
        .day-column-header { font-weight: 700; color: #44403c; font-size: 1.25rem; padding-bottom: 0.75rem; margin-bottom: 0.75rem; border-bottom: 2px solid #F1D24B; }
        .class-entry { background-color: #ffffff; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; }
        .class-entry:hover { transform: translateY(-2px); box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
        .class-tag { font-size: 0.625rem; font-weight: 700; padding: 2px 8px; border-radius: 9999px; color: white; margin-bottom: 4px; display: inline-block; text-transform: uppercase; }
        .tag-turma { background-color: #FF5C3D; }
        .tag-vip { background-color: #8671D1; }
        
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .data-table th { font-weight: 600; font-size: 0.875rem; color: #6b7280; }
        .data-table tbody tr.paid { background-color: #f9fafb; color: #9ca3af; }
        .data-table tbody tr.paid .font-medium { text-decoration: line-through; }
        .data-table tbody tr:not(.paid):hover { background-color: #f9fafb; cursor: pointer; }
        .data-total { margin-top: 1.5rem; text-align: right; }
        .data-total p { font-size: 1.25rem; font-weight: 700; color: #1f2937; }

        .form-input { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; }
        .form-input:disabled { background-color: #f3f4f6; cursor: not-allowed; }
        .primary-btn { background-color: #F1D24B; color: #44403c; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: 600; transition: background-color 0.2s; width: 100%; border: none; cursor: pointer; }
        .primary-btn:hover { background-color: #eab308; }
        .secondary-btn { background-color: #f3f4f6; color: #4b5563; border: 1px solid #d1d5db; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; transition: all 0.2s; }
        .secondary-btn:hover { background-color: #e5e7eb; }
        .secondary-btn.active { background-color: #F1D24B; color: #44403c; border-color: #F1D24B;}
        .danger-btn { background-color: #ef4444; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; transition: background-color 0.2s; border: none; cursor: pointer; }
        .danger-btn:hover { background-color: #dc2626; }

        /* --- CPs Styles --- */
        .cp-level-card { background-color: #fff; border-radius: 0.75rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #e7e5e4; }
        .cp-level-header { padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .cp-level-content { padding: 0 1.5rem; max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, padding-bottom 0.3s ease-out; }
        .cp-level-card.open .cp-level-content { max-height: 6000px; padding-bottom: 1.5rem; }
        .cp-lesson-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-radius: 0.5rem; }
        .cp-lesson-item:nth-child(odd) { background-color: #f9fafb; }

        /* --- Banco de Fotos Styles --- */
        .folder-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; }
        .folder-card { background-color: #fff; border-radius: 0.75rem; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s; border: 1px solid #e7e5e4; position: relative; }
        .folder-card:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: #F1D24B; }
        .folder-delete-btn { position: absolute; top: 0.5rem; right: 0.5rem; background: none; border: none; cursor: pointer; color: #d1d5db; padding: 0.25rem; border-radius: 9999px; }
        .folder-card:hover .folder-delete-btn { color: #9ca3af; }
        .folder-delete-btn:hover { color: #ef4444; background-color: #fef2f2; }
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; }
        .photo-card { background-color: #fff; border-radius: 0.75rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #e7e5e4; }
        .photo-card img { width: 100%; height: 200px; object-fit: cover; }
        .photo-card-info { padding: 1rem; }

        /* --- PEF Styles (Integrated) --- */
        .pef-lesson-row { display: grid; grid-template-columns: 80px 150px 1fr; align-items: start; gap: 1rem; padding: 1rem 0.75rem; border-bottom: 1px solid #e5e7eb; }
        .pef-lesson-row:last-child { border-bottom: none; }
        .pef-student-attendance-row { display: flex; align-items: center; justify-content: space-between; margin-left: 1rem; padding: 0.5rem 0; }
        .pef-status-btn-group button { width: 2.5rem; height: 2.5rem; border-radius: 0.375rem; border: 1px solid #d1d5db; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s; background-color: #f9fafb; }
        .pef-status-btn-group button:hover { border-color: #a8a29e; }
        .pef-status-btn-group button.active.P { background-color: #10B981; color: white; border-color: #10B981; }
        .pef-status-btn-group button.active.F { background-color: #EF4444; color: white; border-color: #EF4444; }
        .pef-status-btn-group button.active.PP { background-color: #F59E0B; color: white; border-color: #F59E0B; }

        /* --- Calendar Styles --- */
        .calendar-container { max-width: 1200px; margin: 0 auto; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .calendar-nav-btn { background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .calendar-nav-btn:hover { background-color: #e5e7eb; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; border-radius: 0.5rem; overflow: hidden; }
        .calendar-day-header { background-color: #f9fafb; padding: 1rem; text-align: center; font-weight: 700; color: #44403c; }
        .calendar-day { background-color: white; min-height: 120px; padding: 0.5rem; position: relative; cursor: pointer; transition: background-color 0.2s; }
        .calendar-day:hover { background-color: #fffbeb; }
        .calendar-day.other-month { background-color: #f9fafb; color: #9ca3af; }
        .calendar-day.today { background-color: #fef3c7; border: 2px solid #F1D24B; }
        .calendar-day-number { font-weight: 600; margin-bottom: 0.25rem; }
        .calendar-event { background-color: #F1D24B; color: #44403c; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600; margin-bottom: 0.25rem; }
        .calendar-event-turma { background-color: #FF5C3D; color: white; }
        .calendar-event-vip { background-color: #8671D1; color: white; }

        /* Responsive */
        @media (max-width: 768px) {
            .schedule-grid { grid-template-columns: 1fr; }
            .folder-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
            .photo-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="bg-stone-50">
    <!-- Navigation -->
    <nav class="bg-white border-b border-stone-200 px-6 py-4 sticky top-0 z-40">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-8">
                <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749543462/SLAP_LOGO_AMARELO_c7ohfw.png" alt="SLAP Logo" class="h-8">
                <div class="flex space-x-1">
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('overview')">Visão Geral</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('alunos')">Alunos</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('turmas')">Turmas</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('vip')">VIP</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('tarefas')">Tarefas</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('agenda')">Cronograma</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('financeiro')">Financeiro</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('cps')">CPs</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('banco-fotos')">Banco de Fotos</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('pef')">PEF</button>
                    <button class="nav-item px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showSection('calendario')">Calendário</button>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-sm text-stone-600" id="current-date"></span>
                <div class="user-tag tag-admin">Administrador</div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="container mx-auto px-6 py-8">
        
        <!-- Overview Section -->
        <div id="overview-section" class="section">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Hub SLAP</h2>
                <p class="text-stone-600">Gerenciamento integrado de ensino musical</p>
            </div>
            
            <!-- Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Total de Alunos</h3>
                    <p class="text-2xl font-bold text-stone-800" id="total-students">0</p>
                </div>
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Modalidade Turma</h3>
                    <p class="text-2xl font-bold text-stone-800" id="turma-students">0</p>
                </div>
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Modalidade VIP</h3>
                    <p class="text-2xl font-bold text-stone-800" id="vip-students">0</p>
                </div>
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Tarefas Pendentes</h3>
                    <p class="text-2xl font-bold text-stone-800" id="pending-tasks">0</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="base-card cursor-pointer" onclick="showSection('alunos')">
                    <h3 class="text-lg font-semibold text-stone-800 mb-2">Gerenciar Alunos</h3>
                    <p class="text-stone-600 text-sm">Adicionar, editar e visualizar informações dos alunos</p>
                </div>
                <div class="base-card cursor-pointer" onclick="showSection('tarefas')">
                    <h3 class="text-lg font-semibold text-stone-800 mb-2">Controle de Tarefas</h3>
                    <p class="text-stone-600 text-sm">Organizar e acompanhar atividades pendentes</p>
                </div>
                <div class="base-card cursor-pointer" onclick="showSection('agenda')">
                    <h3 class="text-lg font-semibold text-stone-800 mb-2">Cronograma de Aulas</h3>
                    <p class="text-stone-600 text-sm">Visualizar horários e planejamento semanal</p>
                </div>
            </div>
        </div>

        <!-- Students Section -->
        <div id="alunos-section" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-stone-800">Gestão de Alunos</h2>
                <button class="primary-btn w-auto" onclick="openStudentModal()">+ Novo Aluno</button>
            </div>

            <!-- Search and Filter -->
            <div class="base-card mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="student-search" placeholder="Buscar alunos..." class="form-input" oninput="filterStudents()">
                    </div>
                    <div class="flex gap-2">
                        <button class="secondary-btn" onclick="filterByModality('all')" id="filter-all">Todos</button>
                        <button class="secondary-btn" onclick="filterByModality('TURMA')" id="filter-turma">Turma</button>
                        <button class="secondary-btn" onclick="filterByModality('VIP')" id="filter-vip">VIP</button>
                    </div>
                </div>
            </div>

            <!-- Students List -->
            <div id="students-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Students will be populated here -->
            </div>
        </div>

        <!-- Turmas Section -->
        <div id="turmas-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Modalidade Turma</h2>
                <p class="text-stone-600">Alunos em modalidade de turma</p>
            </div>
            
            <!-- Turma Students List -->
            <div id="turma-students-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Turma students will be populated here -->
            </div>
        </div>

        <!-- VIP Section -->
        <div id="vip-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Modalidade VIP</h2>
                <p class="text-stone-600">Alunos em modalidade VIP</p>
            </div>
            
            <!-- VIP Students List -->
            <div id="vip-students-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- VIP students will be populated here -->
            </div>
        </div>

        <!-- Tasks Section -->
        <div id="tarefas-section" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-stone-800">Controle de Tarefas</h2>
                <button class="primary-btn w-auto" onclick="openTaskModal()">+ Nova Tarefa</button>
            </div>

            <!-- Task Filters -->
            <div class="base-card mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="secondary-btn active" onclick="filterTasks('all')" id="task-filter-all">Todas</button>
                    <button class="secondary-btn" onclick="filterTasks('pending')" id="task-filter-pending">Pendentes</button>
                    <button class="secondary-btn" onclick="filterTasks('completed')" id="task-filter-completed">Concluídas</button>
                    <button class="secondary-btn" onclick="filterTasks('financeiro')" id="task-filter-financeiro">Financeiro</button>
                    <button class="secondary-btn" onclick="filterTasks('pedagógico')" id="task-filter-pedagogico">Pedagógico</button>
                    <button class="secondary-btn" onclick="filterTasks('comercial')" id="task-filter-comercial">Comercial</button>
                    <button class="secondary-btn" onclick="filterTasks('marketing')" id="task-filter-marketing">Marketing</button>
                </div>
            </div>

            <!-- Tasks List -->
            <div id="tasks-list">
                <!-- Tasks will be populated here -->
            </div>
        </div>

        <!-- Schedule Section -->
        <div id="agenda-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Cronograma de Aulas</h2>
                <p class="text-stone-600">Visualização semanal do calendário de aulas</p>
            </div>

            <!-- Schedule Grid -->
            <div class="schedule-grid">
                <div class="day-column">
                    <div class="day-column-header">Segunda-feira</div>
                    <div id="monday-classes"></div>
                </div>
                <div class="day-column">
                    <div class="day-column-header">Terça-feira</div>
                    <div id="tuesday-classes"></div>
                </div>
                <div class="day-column">
                    <div class="day-column-header">Quarta-feira</div>
                    <div id="wednesday-classes"></div>
                </div>
                <div class="day-column">
                    <div class="day-column-header">Quinta-feira</div>
                    <div id="thursday-classes"></div>
                </div>
                <div class="day-column">
                    <div class="day-column-header">Sexta-feira</div>
                    <div id="friday-classes"></div>
                </div>
                <div class="day-column">
                    <div class="day-column-header">Sábado</div>
                    <div id="saturday-classes"></div>
                </div>
            </div>
        </div>

        <!-- Financial Section -->
        <div id="financeiro-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Controle Financeiro</h2>
                <p class="text-stone-600">Gestão de mensalidades e pagamentos</p>
            </div>

            <!-- Financial Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Recebido este mês</h3>
                    <p class="text-2xl font-bold text-green-600" id="monthly-received">R$ 0,00</p>
                </div>
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Pendente</h3>
                    <p class="text-2xl font-bold text-yellow-600" id="monthly-pending">R$ 0,00</p>
                </div>
                <div class="base-card">
                    <h3 class="text-sm font-semibold text-stone-600 mb-2">Total esperado</h3>
                    <p class="text-2xl font-bold text-stone-800" id="monthly-total">R$ 0,00</p>
                </div>
            </div>

            <!-- Payments Table -->
            <div class="base-card">
                <h3 class="text-lg font-semibold text-stone-800 mb-4">Mensalidades - Janeiro 2025</h3>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Aluno</th>
                                <th>Modalidade</th>
                                <th>Valor</th>
                                <th>Vencimento</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="payments-table-body">
                            <!-- Payments will be populated here -->
                        </tbody>
                    </table>
                </div>
                <div class="data-total">
                    <p id="total-amount">Total: R$ 0,00</p>
                </div>
            </div>
        </div>

        <!-- CPs Section -->
        <div id="cps-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Cronograma Pedagógico (CPs)</h2>
                <p class="text-stone-600">Conteúdo programático organizado por níveis</p>
            </div>

            <!-- Grade Selection -->
            <div class="grade-select-container">
                <select class="grade-select" id="grade-selector" onchange="loadCPContent()">
                    <option value="">Selecione uma série</option>
                    <option value="1ano">1º Ano</option>
                    <option value="2ano">2º Ano</option>
                    <option value="3ano">3º Ano</option>
                    <option value="4ano">4º Ano</option>
                    <option value="5ano">5º Ano</option>
                </select>
            </div>

            <!-- CP Content -->
            <div id="cp-content">
                <!-- CP levels will be populated here -->
            </div>
        </div>

        <!-- Photo Bank Section -->
        <div id="banco-fotos-section" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-stone-800 mb-2">Banco de Fotos</h2>
                    <p class="text-stone-600">Galeria organizada de imagens e materiais</p>
                </div>
                <button class="primary-btn w-auto" onclick="openFolderModal()">+ Nova Pasta</button>
            </div>

            <!-- Folder Grid -->
            <div id="folders-grid" class="folder-grid">
                <!-- Folders will be populated here -->
            </div>
        </div>

        <!-- PEF Section -->
        <div id="pef-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">PEF - Presença Escolar e Familiar</h2>
                <p class="text-stone-600">Controle de frequência dos alunos</p>
            </div>

            <!-- Date and Class Selection -->
            <div class="base-card mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Data da Aula</label>
                        <input type="date" id="pef-date" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Turma/Modalidade</label>
                        <select class="form-input" id="pef-class">
                            <option value="">Selecione uma turma</option>
                            <option value="turma">Modalidade Turma</option>
                            <option value="vip">Modalidade VIP</option>
                        </select>
                    </div>
                </div>
                <button class="primary-btn mt-4" onclick="loadPEFData()">Carregar Dados</button>
            </div>

            <!-- PEF Content -->
            <div id="pef-content" class="base-card">
                <p class="text-stone-600 text-center">Selecione uma data e turma para começar</p>
            </div>
        </div>

        <!-- Calendar Section -->
        <div id="calendario-section" class="section hidden">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h2 class="text-3xl font-bold text-stone-800">Calendário</h2>
                    <div class="flex items-center space-x-4">
                        <button class="calendar-nav-btn" onclick="previousMonth()">← Anterior</button>
                        <h3 class="text-xl font-semibold text-stone-800" id="calendar-month-year"></h3>
                        <button class="calendar-nav-btn" onclick="nextMonth()">Próximo →</button>
                    </div>
                </div>
                
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="student-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="student-modal-title">Novo Aluno</h4>
                <button class="modal-close-btn" onclick="closeStudentModal()">✕</button>
            </div>
            <form id="student-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Nome Completo</label>
                        <input type="text" id="student-name" class="form-input" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Modalidade</label>
                        <select id="student-modality" class="form-input" required>
                            <option value="">Selecione a modalidade</option>
                            <option value="TURMA">Turma</option>
                            <option value="VIP">VIP</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Idade</label>
                        <input type="number" id="student-age" class="form-input" min="1" max="100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Instrumento Principal</label>
                        <input type="text" id="student-instrument" class="form-input">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Telefone</label>
                        <input type="tel" id="student-phone" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Email</label>
                        <input type="email" id="student-email" class="form-input">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-stone-700 mb-2">Observações</label>
                    <textarea id="student-notes" class="form-input" rows="3"></textarea>
                </div>
                <div class="flex gap-4">
                    <button type="button" class="secondary-btn flex-1" onclick="closeStudentModal()">Cancelar</button>
                    <button type="submit" class="primary-btn flex-1">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="task-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Nova Tarefa</h4>
                <button class="modal-close-btn" onclick="closeTaskModal()">✕</button>
            </div>
            <form id="task-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-stone-700 mb-2">Título da Tarefa</label>
                    <input type="text" id="task-title" class="form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-stone-700 mb-2">Descrição</label>
                    <textarea id="task-description" class="form-input" rows="3"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Setor</label>
                        <select id="task-sector" class="form-input" required>
                            <option value="">Selecione o setor</option>
                            <option value="financeiro">Financeiro</option>
                            <option value="pedagógico">Pedagógico</option>
                            <option value="comercial">Comercial</option>
                            <option value="marketing">Marketing</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Prazo</label>
                        <input type="date" id="task-deadline" class="form-input">
                    </div>
                </div>
                <div class="flex gap-4">
                    <button type="button" class="secondary-btn flex-1" onclick="closeTaskModal()">Cancelar</button>
                    <button type="submit" class="primary-btn flex-1">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Folder Modal -->
    <div id="folder-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Nova Pasta</h4>
                <button class="modal-close-btn" onclick="closeFolderModal()">✕</button>
            </div>
            <form id="folder-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-stone-700 mb-2">Nome da Pasta</label>
                    <input type="text" id="folder-name" class="form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-stone-700 mb-2">Descrição</label>
                    <textarea id="folder-description" class="form-input" rows="3"></textarea>
                </div>
                <div class="flex gap-4">
                    <button type="button" class="secondary-btn flex-1" onclick="closeFolderModal()">Cancelar</button>
                    <button type="submit" class="primary-btn flex-1">Criar Pasta</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let folders = JSON.parse(localStorage.getItem('folders')) || [];
        let currentSection = 'overview';
        let editingStudentId = null;
        let currentTaskFilter = 'all';
        let currentModalityFilter = 'all';
        let currentDate = new Date();
        let currentCalendarDate = new Date();

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            showSection('overview');
            updateMetrics();
            loadStudents();
            loadTasks();
            loadFolders();
            loadSchedule();
            loadFinancialData();
            renderCalendar();
            
            // Migrate existing students to include modality
            migrateStudentData();
        });

        // Migrate existing student data to include modality field
        function migrateStudentData() {
            let migrated = false;
            students.forEach(student => {
                if (!student.modality) {
                    student.modality = 'TURMA'; // Default to TURMA for existing students
                    migrated = true;
                }
            });
            
            if (migrated) {
                localStorage.setItem('students', JSON.stringify(students));
                updateMetrics();
                loadStudents();
            }
        }

        // Update current date display
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('current-date').textContent = now.toLocaleDateString('pt-BR', options);
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Add active class to current nav item
            event.target.classList.add('active');
            
            currentSection = sectionName;
            
            // Load section-specific data
            if (sectionName === 'turmas') {
                loadTurmaStudents();
            } else if (sectionName === 'vip') {
                loadVipStudents();
            } else if (sectionName === 'alunos') {
                loadStudents();
            } else if (sectionName === 'calendario') {
                renderCalendar();
            }
        }

        // Update metrics on overview
        function updateMetrics() {
            const totalStudents = students.length;
            const turmaStudents = students.filter(s => s.modality === 'TURMA').length;
            const vipStudents = students.filter(s => s.modality === 'VIP').length;
            const pendingTasks = tasks.filter(t => !t.completed).length;

            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('turma-students').textContent = turmaStudents;
            document.getElementById('vip-students').textContent = vipStudents;
            document.getElementById('pending-tasks').textContent = pendingTasks;
        }

        // Student Management
        function openStudentModal(studentId = null) {
            editingStudentId = studentId;
            const modal = document.getElementById('student-modal');
            const title = document.getElementById('student-modal-title');
            const form = document.getElementById('student-form');
            
            if (studentId) {
                title.textContent = 'Editar Aluno';
                const student = students.find(s => s.id === studentId);
                if (student) {
                    document.getElementById('student-name').value = student.name;
                    document.getElementById('student-modality').value = student.modality || 'TURMA';
                    document.getElementById('student-age').value = student.age || '';
                    document.getElementById('student-instrument').value = student.instrument || '';
                    document.getElementById('student-phone').value = student.phone || '';
                    document.getElementById('student-email').value = student.email || '';
                    document.getElementById('student-notes').value = student.notes || '';
                }
            } else {
                title.textContent = 'Novo Aluno';
                form.reset();
            }
            
            modal.classList.add('visible');
        }

        function closeStudentModal() {
            document.getElementById('student-modal').classList.remove('visible');
            editingStudentId = null;
        }

        function filterByModality(modality) {
            currentModalityFilter = modality;
            
            // Update filter buttons
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('filter-' + modality).classList.add('active');
            
            loadStudents();
        }

        function filterStudents() {
            loadStudents();
        }

        function loadStudents() {
            const searchTerm = document.getElementById('student-search').value.toLowerCase();
            let filteredStudents = students;

            // Filter by search term
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(student => 
                    student.name.toLowerCase().includes(searchTerm) ||
                    (student.instrument && student.instrument.toLowerCase().includes(searchTerm))
                );
            }

            // Filter by modality
            if (currentModalityFilter !== 'all') {
                filteredStudents = filteredStudents.filter(student => 
                    student.modality === currentModalityFilter
                );
            }

            renderStudents(filteredStudents, 'students-list');
        }

        function loadTurmaStudents() {
            const turmaStudents = students.filter(s => s.modality === 'TURMA');
            renderStudents(turmaStudents, 'turma-students-list');
        }

        function loadVipStudents() {
            const vipStudents = students.filter(s => s.modality === 'VIP');
            renderStudents(vipStudents, 'vip-students-list');
        }

        function renderStudents(studentList, containerId) {
            const container = document.getElementById(containerId);
            
            if (studentList.length === 0) {
                container.innerHTML = '<p class="text-stone-600 text-center col-span-full">Nenhum aluno encontrado</p>';
                return;
            }

            container.innerHTML = studentList.map(student => `
                <div class="base-card">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold text-stone-800">${student.name}</h3>
                        <span class="modality-tag modality-${student.modality.toLowerCase()}">${student.modality}</span>
                    </div>
                    ${student.age ? `<p class="text-sm text-stone-600 mb-1"><strong>Idade:</strong> ${student.age} anos</p>` : ''}
                    ${student.instrument ? `<p class="text-sm text-stone-600 mb-1"><strong>Instrumento:</strong> ${student.instrument}</p>` : ''}
                    ${student.phone ? `<p class="text-sm text-stone-600 mb-1"><strong>Telefone:</strong> ${student.phone}</p>` : ''}
                    ${student.email ? `<p class="text-sm text-stone-600 mb-1"><strong>Email:</strong> ${student.email}</p>` : ''}
                    ${student.notes ? `<p class="text-sm text-stone-600 mb-3"><strong>Observações:</strong> ${student.notes}</p>` : ''}
                    <div class="flex gap-2 mt-4">
                        <button class="secondary-btn flex-1" onclick="openStudentModal('${student.id}')">Editar</button>
                        <button class="danger-btn" onclick="deleteStudent('${student.id}')">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteStudent(studentId) {
            if (confirm('Tem certeza que deseja excluir este aluno?')) {
                students = students.filter(s => s.id !== studentId);
                localStorage.setItem('students', JSON.stringify(students));
                loadStudents();
                updateMetrics();
                
                // Reload current section if it's turmas or vip
                if (currentSection === 'turmas') {
                    loadTurmaStudents();
                } else if (currentSection === 'vip') {
                    loadVipStudents();
                }
            }
        }

        // Student form submission
        document.getElementById('student-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentData = {
                id: editingStudentId || Date.now().toString(),
                name: document.getElementById('student-name').value,
                modality: document.getElementById('student-modality').value,
                age: document.getElementById('student-age').value,
                instrument: document.getElementById('student-instrument').value,
                phone: document.getElementById('student-phone').value,
                email: document.getElementById('student-email').value,
                notes: document.getElementById('student-notes').value,
                createdAt: editingStudentId ? students.find(s => s.id === editingStudentId).createdAt : new Date().toISOString()
            };

            if (editingStudentId) {
                const index = students.findIndex(s => s.id === editingStudentId);
                students[index] = studentData;
            } else {
                students.push(studentData);
            }

            localStorage.setItem('students', JSON.stringify(students));
            closeStudentModal();
            loadStudents();
            updateMetrics();
            
            // Reload current section if it's turmas or vip
            if (currentSection === 'turmas') {
                loadTurmaStudents();
            } else if (currentSection === 'vip') {
                loadVipStudents();
            }
        });

        // Task Management
        function openTaskModal() {
            document.getElementById('task-modal').classList.add('visible');
        }

        function closeTaskModal() {
            document.getElementById('task-modal').classList.remove('visible');
            document.getElementById('task-form').reset();
        }

        function filterTasks(filter) {
            currentTaskFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('[id^="task-filter-"]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('task-filter-' + filter).classList.add('active');
            
            loadTasks();
        }

        function loadTasks() {
            let filteredTasks = tasks;

            if (currentTaskFilter !== 'all') {
                if (currentTaskFilter === 'pending') {
                    filteredTasks = tasks.filter(t => !t.completed);
                } else if (currentTaskFilter === 'completed') {
                    filteredTasks = tasks.filter(t => t.completed);
                } else {
                    filteredTasks = tasks.filter(t => t.sector === currentTaskFilter);
                }
            }

            renderTasks(filteredTasks);
        }

        function renderTasks(taskList) {
            const container = document.getElementById('tasks-list');
            
            if (taskList.length === 0) {
                container.innerHTML = '<p class="text-stone-600 text-center">Nenhuma tarefa encontrada</p>';
                return;
            }

            container.innerHTML = taskList.map(task => `
                <div class="task-card ${task.completed ? 'completed' : ''}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-stone-800 mb-2">${task.title}</h3>
                            <p class="text-stone-600 mb-3">${task.description || 'Sem descrição'}</p>
                            <div class="flex items-center gap-3">
                                <span class="status-tag status-${task.sector}">${task.sector}</span>
                                ${task.deadline ? `<span class="deadline-text ${new Date(task.deadline) < new Date() && !task.completed ? 'deadline-overdue' : ''}">
                                    Prazo: ${new Date(task.deadline).toLocaleDateString('pt-BR')}
                                </span>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTaskStatus('${task.id}')" 
                                   class="w-5 h-5 text-yellow-600 rounded focus:ring-yellow-500">
                            <button class="task-delete-btn" onclick="deleteTask('${task.id}')" title="Excluir tarefa">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleTaskStatus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                task.completedAt = task.completed ? new Date().toISOString() : null;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                loadTasks();
                updateMetrics();
            }
        }

        function deleteTask(taskId) {
            if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                loadTasks();
                updateMetrics();
            }
        }

        // Task form submission
        document.getElementById('task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const taskData = {
                id: Date.now().toString(),
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                sector: document.getElementById('task-sector').value,
                deadline: document.getElementById('task-deadline').value,
                completed: false,
                createdAt: new Date().toISOString()
            };

            tasks.push(taskData);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            closeTaskModal();
            loadTasks();
            updateMetrics();
        });

        // Schedule Management
        function loadSchedule() {
            const schedule = {
                monday: [
                    { time: '14:00', class: 'Violão Iniciante', type: 'turma' },
                    { time: '15:00', class: 'Piano Intermediário', type: 'vip' },
                    { time: '16:00', class: 'Guitarra Avançado', type: 'turma' }
                ],
                tuesday: [
                    { time: '14:00', class: 'Violão VIP - João', type: 'vip' },
                    { time: '15:30', class: 'Piano Turma A', type: 'turma' },
                    { time: '17:00', class: 'Bateria Iniciante', type: 'turma' }
                ],
                wednesday: [
                    { time: '14:00', class: 'Violão Intermediário', type: 'turma' },
                    { time: '15:00', class: 'Piano VIP - Maria', type: 'vip' },
                    { time: '16:30', class: 'Guitarra Turma B', type: 'turma' }
                ],
                thursday: [
                    { time: '14:00', class: 'Piano Avançado', type: 'turma' },
                    { time: '15:00', class: 'Violão VIP - Carlos', type: 'vip' },
                    { time: '16:00', class: 'Bateria Intermediário', type: 'turma' }
                ],
                friday: [
                    { time: '14:00', class: 'Guitarra VIP - Ana', type: 'vip' },
                    { time: '15:30', class: 'Violão Turma C', type: 'turma' },
                    { time: '17:00', class: 'Piano Turma B', type: 'turma' }
                ],
                saturday: [
                    { time: '09:00', class: 'Aula de Conjunto A', type: 'turma' },
                    { time: '10:30', class: 'Aula de Conjunto B', type: 'turma' },
                    { time: '14:00', class: 'Workshops VIP', type: 'vip' }
                ]
            };

            Object.keys(schedule).forEach(day => {
                const container = document.getElementById(day + '-classes');
                container.innerHTML = schedule[day].map(item => `
                    <div class="class-entry">
                        <div class="class-tag tag-${item.type}">${item.type.toUpperCase()}</div>
                        <div class="font-medium text-stone-800 text-sm">${item.time}</div>
                        <div class="text-stone-600 text-sm">${item.class}</div>
                    </div>
                `).join('');
            });
        }

        // Financial Management
        function loadFinancialData() {
            const payments = students.map(student => ({
                id: student.id,
                studentName: student.name,
                modality: student.modality || 'TURMA',
                amount: student.modality === 'VIP' ? 200 : 150,
                dueDate: '2025-01-10',
                paid: Math.random() > 0.3 // 70% chance of being paid
            }));

            const tableBody = document.getElementById('payments-table-body');
            const totalReceived = payments.filter(p => p.paid).reduce((sum, p) => sum + p.amount, 0);
            const totalPending = payments.filter(p => !p.paid).reduce((sum, p) => sum + p.amount, 0);
            const totalExpected = totalReceived + totalPending;

            document.getElementById('monthly-received').textContent = `R$ ${totalReceived.toFixed(2).replace('.', ',')}`;
            document.getElementById('monthly-pending').textContent = `R$ ${totalPending.toFixed(2).replace('.', ',')}`;
            document.getElementById('monthly-total').textContent = `R$ ${totalExpected.toFixed(2).replace('.', ',')}`;
            document.getElementById('total-amount').textContent = `Total: R$ ${totalExpected.toFixed(2).replace('.', ',')}`;

            tableBody.innerHTML = payments.map(payment => `
                <tr class="${payment.paid ? 'paid' : ''}">
                    <td class="font-medium">${payment.studentName}</td>
                    <td><span class="modality-tag modality-${payment.modality.toLowerCase()}">${payment.modality}</span></td>
                    <td class="font-medium">R$ ${payment.amount.toFixed(2).replace('.', ',')}</td>
                    <td>${new Date(payment.dueDate).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <span class="status-tag ${payment.paid ? 'status-aprovado' : 'status-pendente'}">
                            ${payment.paid ? 'Pago' : 'Pendente'}
                        </span>
                    </td>
                    <td>
                        <button class="secondary-btn" onclick="togglePaymentStatus('${payment.id}')">
                            ${payment.paid ? 'Marcar Pendente' : 'Marcar Pago'}
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function togglePaymentStatus(studentId) {
            // This would normally update a payments database
            loadFinancialData();
        }

        // CPs Management
        function loadCPContent() {
            const grade = document.getElementById('grade-selector').value;
            const container = document.getElementById('cp-content');
            
            if (!grade) {
                container.innerHTML = '<p class="text-stone-600 text-center">Selecione uma série para visualizar o conteúdo</p>';
                return;
            }

            const cpData = {
                '1ano': [
                    {
                        level: 'Nível 1 - Fundamentos',
                        lessons: [
                            'Introdução ao instrumento',
                            'Postura e técnica básica',
                            'Primeiros acordes',
                            'Exercícios de coordenação'
                        ]
                    },
                    {
                        level: 'Nível 2 - Desenvolvimento',
                        lessons: [
                            'Escalas básicas',
                            'Ritmos fundamentais',
                            'Primeira música completa',
                            'Leitura musical básica'
                        ]
                    }
                ],
                '2ano': [
                    {
                        level: 'Nível 3 - Intermediário',
                        lessons: [
                            'Acordes avançados',
                            'Técnicas de dedilhado',
                            'Improvisação básica',
                            'Harmonia fundamental'
                        ]
                    }
                ]
            };

            const content = cpData[grade] || [];
            
            container.innerHTML = content.map((level, index) => `
                <div class="cp-level-card" data-level="${index}">
                    <div class="cp-level-header" onclick="toggleCPLevel(${index})">
                        <h3 class="text-lg font-semibold text-stone-800">${level.level}</h3>
                        <svg class="w-5 h-5 text-stone-600 transform transition-transform" data-icon="${index}">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="cp-level-content">
                        ${level.lessons.map(lesson => `
                            <div class="cp-lesson-item">
                                <span>${lesson}</span>
                                <input type="checkbox" class="w-4 h-4 text-yellow-600 rounded">
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function toggleCPLevel(levelIndex) {
            const card = document.querySelector(`[data-level="${levelIndex}"]`);
            const icon = document.querySelector(`[data-icon="${levelIndex}"]`);
            
            card.classList.toggle('open');
            icon.classList.toggle('rotate-180');
        }

        // Photo Bank Management
        function openFolderModal() {
            document.getElementById('folder-modal').classList.add('visible');
        }

        function closeFolderModal() {
            document.getElementById('folder-modal').classList.remove('visible');
            document.getElementById('folder-form').reset();
        }

        function loadFolders() {
            const container = document.getElementById('folders-grid');
            
            if (folders.length === 0) {
                container.innerHTML = '<p class="text-stone-600 text-center col-span-full">Nenhuma pasta criada ainda</p>';
                return;
            }

            container.innerHTML = folders.map(folder => `
                <div class="folder-card">
                    <button class="folder-delete-btn" onclick="deleteFolder('${folder.id}')" title="Excluir pasta">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    <svg class="w-16 h-16 text-yellow-500 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path>
                    </svg>
                    <h3 class="font-semibold text-stone-800 mb-2">${folder.name}</h3>
                    <p class="text-sm text-stone-600">${folder.description || 'Sem descrição'}</p>
                </div>
            `).join('');
        }

        function deleteFolder(folderId) {
            if (confirm('Tem certeza que deseja excluir esta pasta?')) {
                folders = folders.filter(f => f.id !== folderId);
                localStorage.setItem('folders', JSON.stringify(folders));
                loadFolders();
            }
        }

        // Folder form submission
        document.getElementById('folder-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const folderData = {
                id: Date.now().toString(),
                name: document.getElementById('folder-name').value,
                description: document.getElementById('folder-description').value,
                createdAt: new Date().toISOString()
            };

            folders.push(folderData);
            localStorage.setItem('folders', JSON.stringify(folders));
            closeFolderModal();
            loadFolders();
        });

        // PEF Management
        function loadPEFData() {
            const date = document.getElementById('pef-date').value;
            const classType = document.getElementById('pef-class').value;
            const container = document.getElementById('pef-content');
            
            if (!date || !classType) {
                container.innerHTML = '<p class="text-stone-600 text-center">Selecione uma data e turma para continuar</p>';
                return;
            }

            const filteredStudents = students.filter(s => s.modality === classType.toUpperCase());
            
            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="text-stone-600 text-center">Nenhum aluno encontrado para esta modalidade</p>';
                return;
            }

            container.innerHTML = `
                <h3 class="text-lg font-semibold text-stone-800 mb-4">
                    Presença - ${new Date(date).toLocaleDateString('pt-BR')} - ${classType.toUpperCase()}
                </h3>
                ${filteredStudents.map(student => `
                    <div class="pef-student-attendance-row">
                        <span class="font-medium">${student.name}</span>
                        <div class="pef-status-btn-group flex gap-1">
                            <button onclick="setPEFStatus('${student.id}', 'P')" data-status="P">P</button>
                            <button onclick="setPEFStatus('${student.id}', 'F')" data-status="F">F</button>
                            <button onclick="setPEFStatus('${student.id}', 'PP')" data-status="PP">PP</button>
                        </div>
                    </div>
                `).join('')}
                <div class="mt-6 pt-4 border-t border-stone-200">
                    <button class="primary-btn" onclick="savePEFData()">Salvar Presenças</button>
                </div>
            `;
        }

        function setPEFStatus(studentId, status) {
            const buttons = document.querySelectorAll(`[data-status]`);
            const studentRow = event.target.closest('.pef-student-attendance-row');
            const studentButtons = studentRow.querySelectorAll('[data-status]');
            
            // Remove active class from all buttons in this row
            studentButtons.forEach(btn => {
                btn.classList.remove('active', 'P', 'F', 'PP');
            });
            
            // Add active class to clicked button
            event.target.classList.add('active', status);
        }

        function savePEFData() {
            alert('Presenças salvas com sucesso!');
        }

        // Calendar Management
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            document.getElementById('calendar-month-year').textContent = 
                currentCalendarDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarGrid = document.getElementById('calendar-grid');
            
            // Create header
            const headers = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            let calendarHTML = headers.map(header => 
                `<div class="calendar-day-header">${header}</div>`
            ).join('');
            
            // Create calendar days
            const current = new Date(startDate);
            const today = new Date();
            
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const isCurrentMonth = current.getMonth() === month;
                    const isToday = current.toDateString() === today.toDateString();
                    
                    let dayClass = 'calendar-day';
                    if (!isCurrentMonth) dayClass += ' other-month';
                    if (isToday) dayClass += ' today';
                    
                    // Sample events
                    let events = '';
                    if (isCurrentMonth && current.getDay() !== 0 && current.getDay() !== 6) {
                        if (Math.random() > 0.7) {
                            events += '<div class="calendar-event calendar-event-turma">Aula Turma</div>';
                        }
                        if (Math.random() > 0.8) {
                            events += '<div class="calendar-event calendar-event-vip">Aula VIP</div>';
                        }
                    }
                    
                    calendarHTML += `
                        <div class="${dayClass}">
                            <div class="calendar-day-number">${current.getDate()}</div>
                            ${events}
                        </div>
                    `;
                    
                    current.setDate(current.getDate() + 1);
                }
            }
            
            calendarGrid.innerHTML = calendarHTML;
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('visible');
            }
        });
    </script>
</body>
</html>
